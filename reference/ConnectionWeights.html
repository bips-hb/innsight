<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Connection Weights Method — ConnectionWeights • innsight</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Connection Weights Method — ConnectionWeights"><meta property="og:description" content="This class implements the Connection Weights method investigated by
Olden et al. (2004) which results in a feature relevance score for each input
variable. The basic idea is to multiply up all path weights for each
possible connection between an input feature and the output node and then
calculate the sum over them. Besides, it is a global interpretation method
and independent of the input data. For a neural network with \(3\) hidden
layers with weight matrices \(W_1\), \(W_2\) and \(W_3\) this method
results in a simple matrix multiplication
$$W_1 * W_2 * W_3. $$"><meta property="og:image" content="https://bips-hb.github.io/innsight/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- dependencies from examples --><script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><script src="libs/plotly-binding-4.10.0/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><script src="libs/jquery-3.5.1/jquery.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet"><script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet"><script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">innsight</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/innsight.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/Custom_Model_Definition.html">Custom Model Definition</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/bips-hb/innsight/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Connection Weights Method</h1>
    <small class="dont-index">Source: <a href="https://github.com/bips-hb/innsight/blob/HEAD/R/ConnectionWeights.R" class="external-link"><code>R/ConnectionWeights.R</code></a></small>
    <div class="hidden name"><code>ConnectionWeights.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This class implements the <em>Connection Weights</em> method investigated by
Olden et al. (2004) which results in a feature relevance score for each input
variable. The basic idea is to multiply up all path weights for each
possible connection between an input feature and the output node and then
calculate the sum over them. Besides, it is a global interpretation method
and independent of the input data. For a neural network with \(3\) hidden
layers with weight matrices \(W_1\), \(W_2\) and \(W_3\) this method
results in a simple matrix multiplication
$$W_1 * W_2 * W_3. $$</p>
    </div>

    <div id="ref-usage">Usage,NULL</div>

    <div id="references">
    <h2>References</h2>
    
<ul><li><p>J. D. Olden et al. (2004) <em>An accurate comparison of methods for
quantifying variable importance in artificial neural networks using
simulated data.</em> Ecological Modelling 178, p. 389–397</p></li>
</ul></div>
    <div id="public-fields">
    <h2>Public fields</h2>
    <p></p><div class="r6-fields"><dl><dt><code>converter</code></dt>
<dd><p>The converter of class <a href="Converter.html">Converter</a> with the stored and
torch-converted model.</p></dd>


<dt><code>channels_first</code></dt>
<dd><p>The data format of the result, i.e. channels on
last dimension (<code>FALSE</code>) or on the first dimension (<code>TRUE</code>). If the
data has no channels, use the default value <code>TRUE</code>.</p></dd>


<dt><code>dtype</code></dt>
<dd><p>The type of the data and parameters (either <code>'float'</code>
for <a href="https://torch.mlverse.org/docs/reference/torch_dtype.html" class="external-link">torch::torch_float</a> or <code>'double'</code> for <a href="https://torch.mlverse.org/docs/reference/torch_dtype.html" class="external-link">torch::torch_double</a>).</p></dd>


<dt><code>result</code></dt>
<dd><p>The methods result as a torch tensor of size
<em>(dim_in, dim_out)</em> and with data type <code>dtype</code>.</p></dd>


<dt><code>output_idx</code></dt>
<dd><p>This vector determines for which outputs the method
will be applied. By default (<code>NULL</code>), all outputs (but limited to the
first 10) are considered.</p></dd>


</dl><p></p></div>
    </div>
    <div id="methods">
    <h2>Methods</h2>
    
<div class="section">
<h3 id="public-methods">Public methods<a class="anchor" aria-label="anchor" href="#public-methods"></a></h3>

<ul><li><p><a href="#method-new"><code>ConnectionWeights$new()</code></a></p></li>
<li><p><a href="#method-get_result"><code>ConnectionWeights$get_result()</code></a></p></li>
<li><p><a href="#method-plot"><code>ConnectionWeights$plot()</code></a></p></li>
<li><p><a href="#method-clone"><code>ConnectionWeights$clone()</code></a></p></li>
</ul></div><p></p><hr><a id="method-new"></a><div class="section">
<h3 id="method-new-">Method <code>new()</code><a class="anchor" aria-label="anchor" href="#method-new-"></a></h3>

<div class="section">
<h4 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span class="va"><a href="../reference/ConnectionWeights.html">ConnectionWeights</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>
  <span class="va">converter</span>,
  output_idx <span class="op">=</span> <span class="cn">NULL</span>,
  channels_first <span class="op">=</span> <span class="cn">TRUE</span>,
  dtype <span class="op">=</span> <span class="st">"float"</span>
<span class="op">)</span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h4>
<p></p><div class="arguments"><dl><dt><code>converter</code></dt>
<dd><p>The converter of class <a href="Converter.html">Converter</a> with the stored and
torch-converted model.</p></dd>


<dt><code>output_idx</code></dt>
<dd><p>This vector determines for which output indices the
method will be applied. By default (<code>NULL</code>), all outputs (but limited
to the first 10) are considered.</p></dd>


<dt><code>channels_first</code></dt>
<dd><p>The data format of the result, i.e. channels on
last dimension (<code>FALSE</code>) or on the first dimension (<code>TRUE</code>). If the
data has no channels, use the default value <code>TRUE</code>.</p></dd>


<dt><code>dtype</code></dt>
<dd><p>The data type for the calculations. Use
either <code>'float'</code> for <a href="https://torch.mlverse.org/docs/reference/torch_dtype.html" class="external-link">torch::torch_float</a> or <code>'double'</code> for
<a href="https://torch.mlverse.org/docs/reference/torch_dtype.html" class="external-link">torch::torch_double</a>.</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-get_result"></a><div class="section">
<h3 id="method-get-result-">Method <code>get_result()</code><a class="anchor" aria-label="anchor" href="#method-get-result-"></a></h3>
<p>This function returns the result of the <em>Connection Weights</em> method
either as an array (<code>'array'</code>), a torch tensor (<code>'torch.tensor'</code> or
<code>'torch_tensor'</code>) of size (dim_in, dim_out) or as a data.frame
(<code>'data.frame'</code>).</p><div class="section">
<h4 id="usage-1">Usage<a class="anchor" aria-label="anchor" href="#usage-1"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span class="va">ConnectionWeights</span><span class="op">$</span><span class="fu">get_result</span><span class="op">(</span>type <span class="op">=</span> <span class="st">"array"</span><span class="op">)</span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-1">Arguments<a class="anchor" aria-label="anchor" href="#arguments-1"></a></h4>
<p></p><div class="arguments"><dl><dt><code>type</code></dt>
<dd><p>The data type of the result. Use one of <code>'array'</code>,
<code>'torch.tensor'</code>, <code>'torch_tensor'</code> or <code>'data.frame'</code>
(default: <code>'array'</code>).</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="returns">Returns<a class="anchor" aria-label="anchor" href="#returns"></a></h4>
<p>The result of this method for the given data in the chosen
type.</p>
</div>

</div><p></p><hr><a id="method-plot"></a><div class="section">
<h3 id="method-plot-">Method <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code><a class="anchor" aria-label="anchor" href="#method-plot-"></a></h3>
<p>This method visualizes the result of the <em>ConnectionWeights</em> method in a
<a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot2::ggplot</a>. You can use the argument <code>output_idx</code> to select
individual output nodes for the plot. The different results for the
selected outputs are visualized using the method <a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">ggplot2::facet_grid</a>.
You can also use the <code>as_plotly</code> argument to generate an interactive
plot based on the plot function <a href="https://rdrr.io/pkg/plotly/man/plot_ly.html" class="external-link">plotly::plot_ly</a>.</p><div class="section">
<h4 id="usage-2">Usage<a class="anchor" aria-label="anchor" href="#usage-2"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span class="va">ConnectionWeights</span><span class="op">$</span><span class="fu">plot</span><span class="op">(</span>
  output_idx <span class="op">=</span> <span class="cn">NULL</span>,
  aggr_channels <span class="op">=</span> <span class="st">"sum"</span>,
  preprocess_FUN <span class="op">=</span> <span class="va">identity</span>,
  as_plotly <span class="op">=</span> <span class="cn">FALSE</span>
<span class="op">)</span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-2">Arguments<a class="anchor" aria-label="anchor" href="#arguments-2"></a></h4>
<p></p><div class="arguments"><dl><dt><code>output_idx</code></dt>
<dd><p>An integer vector containing the numbers of the
output indices whose result is to be plotted, e.g. <code>c(1,4)</code> for the
first and fourth model output. But this vector must be included in the
vector <code>output_idx</code> from the initialization, otherwise, no results were
calculated for this output node and can not be plotted. By default
(<code>NULL</code>), the smallest index of all calculated output nodes is used.</p></dd>


<dt><code>aggr_channels</code></dt>
<dd><p>Pass one of <code>'norm'</code>, <code>'sum'</code>, <code>'mean'</code> or a
custom function to aggregate the channels, e.g. the maximum
(base::max) or minimum (base::min) over the channels or only
individual channels with <code>function(x) x[1]</code>. By default (<code>'sum'</code>),
the sum of all channels is used.<br><strong>Note:</strong> This argument is used only for 2D and 3D inputs.</p></dd>


<dt><code>preprocess_FUN</code></dt>
<dd><p>This function is applied to the method's result
before generating the plot. By default, the identity function
(<code>identity</code>) is used.</p></dd>


<dt><code>as_plotly</code></dt>
<dd><p>This boolean value (default: <code>FALSE</code>) can be used to
create an interactive plot based on the library <code>plotly</code>. This function
takes use of <a href="https://rdrr.io/pkg/plotly/man/ggplotly.html" class="external-link">plotly::ggplotly</a>, hence make sure that the suggested
package <code>plotly</code> is installed in your R session.<br><strong>Advanced:</strong> You can first
output the results as a ggplot (<code>as_plotly = FALSE</code>) and then make
custom changes to the plot, e.g. other theme or other fill color. Then
you can manually call the function <code>ggplotly</code> to get an interactive
plotly plot.</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="returns-1">Returns<a class="anchor" aria-label="anchor" href="#returns-1"></a></h4>
<p>Returns either a <a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot2::ggplot</a> (<code>as_plotly = FALSE</code>) or a
<a href="https://rdrr.io/pkg/plotly/man/plot_ly.html" class="external-link">plotly::plot_ly</a> object (<code>as_plotly = TRUE</code>) with the plotted results.</p>
</div>

</div><p></p><hr><a id="method-clone"></a><div class="section">
<h3 id="method-clone-">Method <code>clone()</code><a class="anchor" aria-label="anchor" href="#method-clone-"></a></h3>
<p>The objects of this class are cloneable with this method.</p><div class="section">
<h4 id="usage-3">Usage<a class="anchor" aria-label="anchor" href="#usage-3"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span class="va">ConnectionWeights</span><span class="op">$</span><span class="fu">clone</span><span class="op">(</span>deep <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-3">Arguments<a class="anchor" aria-label="anchor" href="#arguments-3"></a></h4>
<p></p><div class="arguments"><dl><dt><code>deep</code></dt>
<dd><p>Whether to make a deep clone.</p></dd>


</dl><p></p></div>
</div>

</div>

    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="co">#----------------------- Example 1: Torch ----------------------------------</span></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://torch.mlverse.org/docs" class="external-link">torch</a></span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Create nn_sequential model</span></span>
<span class="r-in"><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torch.mlverse.org/docs/reference/nn_sequential.html" class="external-link">nn_sequential</a></span><span class="op">(</span></span>
<span class="r-in">  <span class="fu"><a href="https://torch.mlverse.org/docs/reference/nn_linear.html" class="external-link">nn_linear</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">12</span><span class="op">)</span>,</span>
<span class="r-in">  <span class="fu"><a href="https://torch.mlverse.org/docs/reference/nn_relu.html" class="external-link">nn_relu</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span class="r-in">  <span class="fu"><a href="https://torch.mlverse.org/docs/reference/nn_linear.html" class="external-link">nn_linear</a></span><span class="op">(</span><span class="fl">12</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span class="r-in">  <span class="fu"><a href="https://torch.mlverse.org/docs/reference/nn_sigmoid.html" class="external-link">nn_sigmoid</a></span><span class="op">(</span><span class="op">)</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Create Converter with input names</span></span>
<span class="r-in"><span class="va">converter</span> <span class="op">&lt;-</span> <span class="va"><a href="Converter.html">Converter</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">model</span>,</span>
<span class="r-in">  input_dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>,</span>
<span class="r-in">  input_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Car"</span>, <span class="st">"Cat"</span>, <span class="st">"Dog"</span>, <span class="st">"Plane"</span>, <span class="st">"Horse"</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Apply method Connection Weights</span></span>
<span class="r-in"><span class="va">cw</span> <span class="op">&lt;-</span> <span class="va">ConnectionWeights</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">converter</span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Backward pass 'ConnectionWeights':</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   |                                                                              |                                                                      |   0%  |                                                                              |===================================                                   |  50%  |                                                                              |======================================================================| 100%</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Print the result as a data.frame</span></span>
<span class="r-in"><span class="va">cw</span><span class="op">$</span><span class="fu">get_result</span><span class="op">(</span><span class="st">"data.frame"</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   feature class       value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     Car    Y1 -0.10509440</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2     Cat    Y1  0.15874031</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3     Dog    Y1  0.17243759</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4   Plane    Y1  0.04673348</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5   Horse    Y1  0.10860981</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Plot the result</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cw</span><span class="op">)</span></span>
<span class="r-plt img"><img src="ConnectionWeights-1.png" alt="" width="700" height="433"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">#----------------------- Example 2: Neuralnet ------------------------------</span></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bips-hb/neuralnet" class="external-link">neuralnet</a></span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Train a Neural Network</span></span>
<span class="r-in"><span class="va">nn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/neuralnet/man/neuralnet.html" class="external-link">neuralnet</a></span><span class="op">(</span><span class="op">(</span><span class="va">Species</span> <span class="op">==</span> <span class="st">"setosa"</span><span class="op">)</span> <span class="op">~</span> <span class="va">Petal.Length</span> <span class="op">+</span> <span class="va">Petal.Width</span>,</span>
<span class="r-in">  <span class="va">iris</span>,</span>
<span class="r-in">  linear.output <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span class="r-in">  hidden <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span>, act.fct <span class="op">=</span> <span class="st">"tanh"</span>, rep <span class="op">=</span> <span class="fl">1</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Convert the trained model</span></span>
<span class="r-in"><span class="va">converter</span> <span class="op">&lt;-</span> <span class="va"><a href="Converter.html">Converter</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">nn</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Apply the Connection Weights method</span></span>
<span class="r-in"><span class="va">cw</span> <span class="op">&lt;-</span> <span class="va">ConnectionWeights</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">converter</span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Backward pass 'ConnectionWeights':</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   |                                                                              |                                                                      |   0%  |                                                                              |=======================                                               |  33%  |                                                                              |===============================================                       |  67%  |                                                                              |======================================================================| 100%</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Get the result as a torch tensor</span></span>
<span class="r-in"><span class="va">cw</span><span class="op">$</span><span class="fu">get_result</span><span class="op">(</span>type <span class="op">=</span> <span class="st">"torch.tensor"</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> torch_tensor</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  14.3904</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  11.9085</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [ CPUFloatType{2,1} ]</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Plot the result</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cw</span><span class="op">)</span></span>
<span class="r-plt img"><img src="ConnectionWeights-2.png" alt="" width="700" height="433"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">#----------------------- Example 3: Keras ----------------------------------</span></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://keras.rstudio.com" class="external-link">keras</a></span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://keras.rstudio.com/reference/is_keras_available.html" class="external-link">is_keras_available</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in">  <span class="co"># Define a model</span></span>
<span class="r-in">  <span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://keras.rstudio.com/reference/keras_model_sequential.html" class="external-link">keras_model_sequential</a></span><span class="op">(</span><span class="op">)</span></span>
<span class="r-in">  <span class="va">model</span> <span class="op"><a href="https://keras.rstudio.com/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span class="r-in">    <span class="fu"><a href="https://keras.rstudio.com/reference/layer_conv_1d.html" class="external-link">layer_conv_1d</a></span><span class="op">(</span></span>
<span class="r-in">      input_shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">64</span>, <span class="fl">3</span><span class="op">)</span>, kernel_size <span class="op">=</span> <span class="fl">16</span>, filters <span class="op">=</span> <span class="fl">8</span>,</span>
<span class="r-in">      activation <span class="op">=</span> <span class="st">"softplus"</span></span>
<span class="r-in">    <span class="op">)</span> <span class="op"><a href="https://keras.rstudio.com/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span class="r-in">    <span class="fu"><a href="https://keras.rstudio.com/reference/layer_conv_1d.html" class="external-link">layer_conv_1d</a></span><span class="op">(</span>kernel_size <span class="op">=</span> <span class="fl">16</span>, filters <span class="op">=</span> <span class="fl">4</span>, activation <span class="op">=</span> <span class="st">"tanh"</span><span class="op">)</span> <span class="op"><a href="https://keras.rstudio.com/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span class="r-in">    <span class="fu"><a href="https://keras.rstudio.com/reference/layer_conv_1d.html" class="external-link">layer_conv_1d</a></span><span class="op">(</span>kernel_size <span class="op">=</span> <span class="fl">16</span>, filters <span class="op">=</span> <span class="fl">2</span>, activation <span class="op">=</span> <span class="st">"relu"</span><span class="op">)</span> <span class="op"><a href="https://keras.rstudio.com/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span class="r-in">    <span class="fu"><a href="https://keras.rstudio.com/reference/layer_flatten.html" class="external-link">layer_flatten</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://keras.rstudio.com/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span class="r-in">    <span class="fu"><a href="https://keras.rstudio.com/reference/layer_dense.html" class="external-link">layer_dense</a></span><span class="op">(</span>units <span class="op">=</span> <span class="fl">64</span>, activation <span class="op">=</span> <span class="st">"relu"</span><span class="op">)</span> <span class="op"><a href="https://keras.rstudio.com/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span class="r-in">    <span class="fu"><a href="https://keras.rstudio.com/reference/layer_dense.html" class="external-link">layer_dense</a></span><span class="op">(</span>units <span class="op">=</span> <span class="fl">2</span>, activation <span class="op">=</span> <span class="st">"softmax"</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in">  <span class="co"># Convert the model</span></span>
<span class="r-in">  <span class="va">converter</span> <span class="op">&lt;-</span> <span class="va"><a href="Converter.html">Converter</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in">  <span class="co"># Apply the Connection Weights method</span></span>
<span class="r-in">  <span class="va">cw</span> <span class="op">&lt;-</span> <span class="va">ConnectionWeights</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">converter</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in">  <span class="co"># Get the result as data.frame</span></span>
<span class="r-in">  <span class="va">cw</span><span class="op">$</span><span class="fu">get_result</span><span class="op">(</span>type <span class="op">=</span> <span class="st">"data.frame"</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in">  <span class="co"># Plot the result for all classes</span></span>
<span class="r-in">  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cw</span>, output_idx <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loaded Tensorflow version 2.7.0</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Backward pass 'ConnectionWeights':</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   |                                                                              |                                                                      |   0%  |                                                                              |============                                                          |  17%  |                                                                              |=======================                                               |  33%  |                                                                              |===================================                                   |  50%  |                                                                              |===============================================                       |  67%  |                                                                              |==========================================================            |  83%  |                                                                              |======================================================================| 100%</span>
<span class="r-plt img"><img src="ConnectionWeights-3.png" alt="" width="700" height="433"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># ------------------------- Advanced: Plotly -------------------------------</span></span>
<span class="r-in"><span class="co"># If you want to create an interactive plot of your results with custom</span></span>
<span class="r-in"><span class="co"># changes, you can take use of the method plotly::ggplotly</span></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://plotly-r.com" class="external-link">plotly</a></span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Attaching package: ‘plotly’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following object is masked from ‘package:ggplot2’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     last_plot</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following object is masked from ‘package:stats’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     filter</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following object is masked from ‘package:graphics’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     layout</span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bips-hb/neuralnet" class="external-link">neuralnet</a></span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">nn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/neuralnet/man/neuralnet.html" class="external-link">neuralnet</a></span><span class="op">(</span><span class="va">Species</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span class="r-in">  <span class="va">iris</span>,</span>
<span class="r-in">  linear.output <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span class="r-in">  hidden <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">8</span><span class="op">)</span>, act.fct <span class="op">=</span> <span class="st">"tanh"</span>, rep <span class="op">=</span> <span class="fl">1</span>, threshold <span class="op">=</span> <span class="fl">0.5</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"><span class="co"># create an converter for this model</span></span>
<span class="r-in"><span class="va">converter</span> <span class="op">&lt;-</span> <span class="va"><a href="Converter.html">Converter</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">nn</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># create new instance of 'LRP'</span></span>
<span class="r-in"><span class="va">cw</span> <span class="op">&lt;-</span> <span class="va">ConnectionWeights</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">converter</span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Backward pass 'ConnectionWeights':</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   |                                                                              |                                                                      |   0%  |                                                                              |=======================                                               |  33%  |                                                                              |===============================================                       |  67%  |                                                                              |======================================================================| 100%</span>
<span class="r-in"></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://plotly-r.com" class="external-link">plotly</a></span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Get the ggplot and add your changes</span></span>
<span class="r-in"><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cw</span>, output_idx <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span class="r-in">  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span class="r-in">  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient2</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"green"</span>, mid <span class="op">=</span> <span class="st">"black"</span>, high <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Scale for 'fill' is already present. Adding another scale for 'fill', which</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> will replace the existing scale.</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Now apply the method plotly::ggplotly with argument tooltip = "text"</span></span>
<span class="r-in"><span class="fu">plotly</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plotly/man/ggplotly.html" class="external-link">ggplotly</a></span><span class="op">(</span><span class="va">p</span>, tooltip <span class="op">=</span> <span class="st">"text"</span><span class="op">)</span></span>
<div id="htmlwidget-aff81a3497aff141ac39" style="width:700px;height:432.632880098888px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-aff81a3497aff141ac39">{"x":{"data":[{"x":[2.7,2.7,3.3,3.3,2.7],"y":[0,-2.58794713020325,-2.58794713020325,0,0],"text":"<b><\/br> Relative Importance : -2.588 <\/b><br /> <\/br> Output:      setosa <\/br> Feature:     Petal.Length","type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"transparent","dash":"solid"},"fill":"toself","fillcolor":"rgba(20,37,15,1)","hoveron":"fills","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[0.7,0.7,1.3,1.3,0.7],"y":[0,4.55849647521973,4.55849647521973,0,0],"text":"<b><\/br> Relative Importance : 4.558 <\/b><br /> <\/br> Output:      setosa <\/br> Feature:     Sepal.Length","type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"transparent","dash":"solid"},"fill":"toself","fillcolor":"rgba(27,15,61,1)","hoveron":"fills","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1.7,1.7,2.3,2.3,1.7],"y":[0,5.9724907875061,5.9724907875061,0,0],"text":"<b><\/br> Relative Importance : 5.972 <\/b><br /> <\/br> Output:      setosa <\/br> Feature:     Sepal.Width","type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"transparent","dash":"solid"},"fill":"toself","fillcolor":"rgba(31,16,80,1)","hoveron":"fills","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[3.7,3.7,4.3,4.3,3.7],"y":[0,17.8135013580322,17.8135013580322,0,0],"text":"<b><\/br> Relative Importance : 17.81 <\/b><br /> <\/br> Output:      setosa <\/br> Feature:     Petal.Width","type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"transparent","dash":"solid"},"fill":"toself","fillcolor":"rgba(0,0,255,1)","hoveron":"fills","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[0.4,4.6],"y":[0,0],"text":"","type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(0,0,0,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":34.9954337899543,"r":18.9954337899543,"b":37.2602739726027,"l":37.2602739726027},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[0.4,4.6],"tickmode":"array","ticktext":["Sepal.Length","Sepal.Width","Petal.Length","Petal.Width"],"tickvals":[1,2,3,4],"categoryorder":"array","categoryarray":["Sepal.Length","Sepal.Width","Petal.Length","Petal.Width"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":"","hoverformat":".2f"},"annotations":[{"text":"Feature","x":0.5,"y":0,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"top","annotationType":"axis","yshift":-21.9178082191781},{"text":"Relative Importance","x":0,"y":0.5,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xref":"paper","yref":"paper","textangle":-90,"xanchor":"right","yanchor":"center","annotationType":"axis","xshift":-21.9178082191781},{"text":"setosa","x":0.5,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(26,26,26,1)","family":"","size":11.689497716895},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"bottom"}],"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-3.60801955461502,18.833573782444],"tickmode":"array","ticktext":["0","5","10","15"],"tickvals":[0,5,10,15],"categoryorder":"array","categoryarray":["0","5","10","15"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":"","hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1},{"type":"rect","fillcolor":"rgba(217,217,217,1)","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":23.37899543379,"yanchor":1,"ysizemode":"pixel"}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895},"title":{"text":"","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"322757c3792a":{"xmin":{},"xmax":{},"ymin":{},"ymax":{},"fill":{},"text":{},"type":"scatter"},"32274f83adc0":{"yintercept":{}}},"cur_data":"322757c3792a","visdat":{"322757c3792a":["function (y) ","x"],"32274f83adc0":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script></code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Niklas Koenen.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.0.</p>
</div>

      </footer></div>

  


  

  </body></html>

