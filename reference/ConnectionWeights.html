<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Connection weights method — ConnectionWeights • innsight</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Connection weights method — ConnectionWeights"><meta property="og:description" content="This class implements the Connection weights method investigated by
Olden et al. (2004), which results in a relevance score for each input
variable. The basic idea is to multiply all path weights for each
possible connection between an input feature and the output node and then
calculate the sum over them. Besides, it is originally a global
interpretation method and independent of the input data. For a neural
network with \(3\) hidden layers with weight matrices \(W_1\),
\(W_2\) and \(W_3\), this method results in a simple matrix
multiplication independent of the activation functions in between:
$$W_1 * W_2 * W_3.$$
In this package, we extended this method to a local method inspired by the
method Gradient\(\times\)Input (see Gradient). Hence, the local variant is
simply the point-wise product of the global Connection weights method and
the input data. You can use this variant by setting the times_input
argument to TRUE and providing input data.
The R6 class can also be initialized using the run_cw function
as a helper function so that no prior knowledge of R6 classes is required."><meta property="og:image" content="https://bips-hb.github.io/innsight/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">innsight</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.3.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/innsight.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/detailed_overview.html">In-depth explanation</a>
    </li>
    <li>
      <a href="../articles/Example_1_iris.html">Example 1: Iris dataset with torch</a>
    </li>
    <li>
      <a href="../articles/Example_2_penguin.html">Example 2: Penguin dataset with torch and luz</a>
    </li>
    <li>
      <a href="../articles/Example_3_imagenet.html">Example 3: ImageNet with keras</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/bips-hb/innsight/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Connection weights method</h1>
    <small class="dont-index">Source: <a href="https://github.com/bips-hb/innsight/blob/master/R/ConnectionWeights.R" class="external-link"><code>R/ConnectionWeights.R</code></a></small>
    <div class="hidden name"><code>ConnectionWeights.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This class implements the <em>Connection weights</em> method investigated by
Olden et al. (2004), which results in a relevance score for each input
variable. The basic idea is to multiply all path weights for each
possible connection between an input feature and the output node and then
calculate the sum over them. Besides, it is originally a global
interpretation method and independent of the input data. For a neural
network with \(3\) hidden layers with weight matrices \(W_1\),
\(W_2\) and \(W_3\), this method results in a simple matrix
multiplication independent of the activation functions in between:
$$W_1 * W_2 * W_3.$$</p>
<p>In this package, we extended this method to a local method inspired by the
method <em>Gradient\(\times\)Input</em> (see <code><a href="Gradient.html">Gradient</a></code>). Hence, the local variant is
simply the point-wise product of the global <em>Connection weights</em> method and
the input data. You can use this variant by setting the <code>times_input</code>
argument to <code>TRUE</code> and providing input data.</p>
<p>The R6 class can also be initialized using the <code><a href="innsight_sugar.html">run_cw</a></code> function
as a helper function so that no prior knowledge of R6 classes is required.</p>
    </div>


    <div id="references">
    <h2>References</h2>

<ul><li><p>J. D. Olden et al. (2004) <em>An accurate comparison of methods for
quantifying variable importance in artificial neural networks using
simulated data.</em> Ecological Modelling 178, p. 389–397</p></li>
</ul></div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>Other methods:
<code><a href="DeepLift.html">DeepLift</a></code>,
<code><a href="DeepSHAP.html">DeepSHAP</a></code>,
<code><a href="ExpectedGradient.html">ExpectedGradient</a></code>,
<code><a href="Gradient.html">Gradient</a></code>,
<code><a href="IntegratedGradient.html">IntegratedGradient</a></code>,
<code><a href="LIME.html">LIME</a></code>,
<code><a href="LRP.html">LRP</a></code>,
<code><a href="SHAP.html">SHAP</a></code>,
<code><a href="SmoothGrad.html">SmoothGrad</a></code></p></div>
    </div>
    <div id="super-class">
    <h2>Super class</h2>
    <p><code><a href="InterpretingMethod.html">innsight::InterpretingMethod</a></code> -&gt; <code>ConnectionWeights</code></p>
    </div>
    <div id="public-fields">
    <h2>Public fields</h2>
    <p></p><div class="r6-fields"><dl><dt><code>times_input</code></dt>
<dd><p>(<code>logical(1)</code>)<br>
This logical value indicates whether the results from
the <em>Connection weights</em> method were multiplied by the provided input
data or not. Thus, this value specifies whether the original global
variant of the method or the local one was applied. If the value is
<code>TRUE</code>, then data is provided in the field <code>data</code>.</p></dd>


</dl><p></p></div>
    </div>
    <div id="methods">
    <h2>Methods</h2>

<div class="section">
<h3 id="public-methods">Public methods<a class="anchor" aria-label="anchor" href="#public-methods"></a></h3>

<ul><li><p><a href="#method-ConnectionWeights-new"><code>ConnectionWeights$new()</code></a></p></li>
<li><p><a href="#method-ConnectionWeights-clone"><code>ConnectionWeights$clone()</code></a></p></li>
</ul></div><p><details open><summary>Inherited methods</summary><ul><li><span class="pkg-link" data-pkg="innsight" data-topic="InterpretingMethod" data-id="get_result"><a href="InterpretingMethod.html#method-get_result"><code>innsight::InterpretingMethod$get_result()</code></a></span></li>
<li><span class="pkg-link" data-pkg="innsight" data-topic="InterpretingMethod" data-id="plot"><a href="InterpretingMethod.html#method-plot"><code>innsight::InterpretingMethod$plot()</code></a></span></li>
<li><span class="pkg-link" data-pkg="innsight" data-topic="InterpretingMethod" data-id="plot_global"><a href="InterpretingMethod.html#method-plot_global"><code>innsight::InterpretingMethod$plot_global()</code></a></span></li>
<li><span class="pkg-link" data-pkg="innsight" data-topic="InterpretingMethod" data-id="print"><a href="InterpretingMethod.html#method-print"><code>innsight::InterpretingMethod$print()</code></a></span></li>
</ul></details></p><hr><a id="method-ConnectionWeights-new"></a><div class="section">
<h3 id="method-new-">Method <code>new()</code><a class="anchor" aria-label="anchor" href="#method-new-"></a></h3>
<p>Create a new instance of the class <code>ConnectionWeights</code>. When
initialized, the method is applied and the results
are stored in the field <code>result</code>.</p><div class="section">
<h4 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va"><a href="../reference/ConnectionWeights.html">ConnectionWeights</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  <span class="va">converter</span>,</span>
<span>  data <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  output_idx <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  output_label <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  channels_first <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  times_input <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  dtype <span class="op">=</span> <span class="st">"float"</span></span>
<span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h4>
<p></p><div class="arguments"><dl><dt><code>converter</code></dt>
<dd><p>(<code><a href="Converter.html">Converter</a></code>)<br>
An instance of the <code>Converter</code> class that includes the
torch-converted model and some other model-specific attributes. See
<code><a href="Converter.html">Converter</a></code> for details.<br></p></dd>


<dt><code>data</code></dt>
<dd><p>(<code><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></code>, <code><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></code>, <code><a href="https://rdrr.io/pkg/torch/man/torch_tensor.html" class="external-link">torch_tensor</a></code> or <code>list</code>)<br>
The data to which the method is to be applied. These must
have the same format as the input data of the passed model to the
converter object. This means either</p><ul><li><p>an <code>array</code>, <code>data.frame</code>, <code>torch_tensor</code> or array-like format of
size <em>(batch_size, dim_in)</em>, if e.g.the model has only one input layer, or</p></li>
<li><p>a <code>list</code> with the corresponding input data (according to the
upper point) for each of the input layers.</p></li>
</ul><p>This argument is only relevant if
<code>times_input</code> is <code>TRUE</code>, otherwise it will be ignored because it is a
locale (i.e. explanation for each data point individually) method only
in this case.<br></p></dd>


<dt><code>output_idx</code></dt>
<dd><p>(<code>integer</code>, <code>list</code> or <code>NULL</code>)<br>
These indices specify the output nodes for which
the method is to be applied. In order to allow models with multiple
output layers, there are the following possibilities to select
the indices of the output nodes in the individual output layers:</p><ul><li><p>An <code>integer</code> vector of indices: If the model has only one output
layer, the values correspond to the indices of the output nodes, e.g.,
<code>c(1,3,4)</code> for the first, third and fourth output node. If there are
multiple output layers, the indices of the output nodes from the first
output layer are considered.</p></li>
<li><p>A <code>list</code> of <code>integer</code> vectors of indices: If the method is to be
applied to output nodes from different layers, a list can be passed
that specifies the desired indices of the output nodes for each
output layer. Unwanted output layers have the entry <code>NULL</code> instead of
a vector of indices, e.g., <code>list(NULL, c(1,3))</code> for the first and
third output node in the second output layer.</p></li>
<li><p><code>NULL</code> (default): The method is applied to all output nodes in
the first output layer but is limited to the first ten as the
calculations become more computationally expensive for more output
nodes.<br></p></li>
</ul></dd>


<dt><code>output_label</code></dt>
<dd><p>(<code>character</code>, <code>factor</code>, <code>list</code> or <code>NULL</code>)<br>
These values specify the output nodes for which
the method is to be applied. Only values that were previously passed with
the argument <code>output_names</code> in the <code>converter</code> can be used. In order to
allow models with multiple
output layers, there are the following possibilities to select
the names of the output nodes in the individual output layers:</p><ul><li><p>A <code>character</code> vector or <code>factor</code> of labels: If the model has only one output
layer, the values correspond to the labels of the output nodes named in the
passed <code>Converter</code> object, e.g.,
<code>c("a", "c", "d")</code> for the first, third and fourth output node if the
output names are <code>c("a", "b", "c", "d")</code>. If there are
multiple output layers, the names of the output nodes from the first
output layer are considered.</p></li>
<li><p>A <code>list</code> of <code>charactor</code>/<code>factor</code> vectors of labels: If the method is to be
applied to output nodes from different layers, a list can be passed
that specifies the desired labels of the output nodes for each
output layer. Unwanted output layers have the entry <code>NULL</code> instead of
a vector of labels, e.g., <code>list(NULL, c("a", "c"))</code> for the first and
third output node in the second output layer.</p></li>
<li><p><code>NULL</code> (default): The method is applied to all output nodes in
the first output layer but is limited to the first ten as the
calculations become more computationally expensive for more output
nodes.<br></p></li>
</ul></dd>


<dt><code>channels_first</code></dt>
<dd><p>(<code>logical(1)</code>)<br>
The channel position of the given data (argument
<code>data</code>). If <code>TRUE</code>, the channel axis is placed at the second position
between the batch size and the rest of the input axes, e.g.,
<code>c(10,3,32,32)</code> for a batch of ten images with three channels and a
height and width of 32 pixels. Otherwise (<code>FALSE</code>), the channel axis
is at the last position, i.e., <code>c(10,32,32,3)</code>. If the data
has no channel axis, use the default value <code>TRUE</code>.<br></p></dd>


<dt><code>times_input</code></dt>
<dd><p>(<code>logical(1)</code>)<br>
Multiplies the results with the input features.
This variant turns the global <em>Connection weights</em> method into a local
one. Default: <code>FALSE</code>.<br></p></dd>


<dt><code>verbose</code></dt>
<dd><p>(<code>logical(1)</code>)<br>
This logical argument determines whether a progress bar is
displayed for the calculation of the method or not. The default value is
the output of the primitive R function <code><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive()</a></code>.<br></p></dd>


<dt><code>dtype</code></dt>
<dd><p>(<code>character(1)</code>)<br>
The data type for the calculations. Use
either <code>'float'</code> for <a href="https://rdrr.io/pkg/torch/man/torch_dtype.html" class="external-link">torch_float</a> or <code>'double'</code> for
<a href="https://rdrr.io/pkg/torch/man/torch_dtype.html" class="external-link">torch_double</a>.<br></p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-ConnectionWeights-clone"></a><div class="section">
<h3 id="method-clone-">Method <code>clone()</code><a class="anchor" aria-label="anchor" href="#method-clone-"></a></h3>
<p>The objects of this class are cloneable with this method.</p><div class="section">
<h4 id="usage-1">Usage<a class="anchor" aria-label="anchor" href="#usage-1"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ConnectionWeights</span><span class="op">$</span><span class="fu">clone</span><span class="op">(</span>deep <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-1">Arguments<a class="anchor" aria-label="anchor" href="#arguments-1"></a></h4>
<p></p><div class="arguments"><dl><dt><code>deep</code></dt>
<dd><p>Whether to make a deep clone.</p></dd>


</dl><p></p></div>
</div>

</div>

    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">#----------------------- Example 1: Torch ----------------------------------</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://torch.mlverse.org/docs" class="external-link">torch</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create nn_sequential model</span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/torch/man/nn_sequential.html" class="external-link">nn_sequential</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/pkg/torch/man/nn_linear.html" class="external-link">nn_linear</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">12</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/pkg/torch/man/nn_relu.html" class="external-link">nn_relu</a></span><span class="op">(</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/pkg/torch/man/nn_linear.html" class="external-link">nn_linear</a></span><span class="op">(</span><span class="fl">12</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/pkg/torch/man/nn_sigmoid.html" class="external-link">nn_sigmoid</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create Converter with input names</span></span></span>
<span class="r-in"><span><span class="va">converter</span> <span class="op">&lt;-</span> <span class="va"><a href="Converter.html">Converter</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">model</span>,</span></span>
<span class="r-in"><span>  input_dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  input_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Car"</span>, <span class="st">"Cat"</span>, <span class="st">"Dog"</span>, <span class="st">"Plane"</span>, <span class="st">"Horse"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># You can also use the helper function for the initialization part</span></span></span>
<span class="r-in"><span><span class="va">converter</span> <span class="op">&lt;-</span> <span class="fu"><a href="innsight_sugar.html">convert</a></span><span class="op">(</span><span class="va">model</span>,</span></span>
<span class="r-in"><span>  input_dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  input_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Car"</span>, <span class="st">"Cat"</span>, <span class="st">"Dog"</span>, <span class="st">"Plane"</span>, <span class="st">"Horse"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Apply method Connection Weights</span></span></span>
<span class="r-in"><span><span class="va">cw</span> <span class="op">&lt;-</span> <span class="va">ConnectionWeights</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">converter</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Again, you can use a helper function `run_cw()` for initializing</span></span></span>
<span class="r-in"><span><span class="va">cw</span> <span class="op">&lt;-</span> <span class="fu"><a href="innsight_sugar.html">run_cw</a></span><span class="op">(</span><span class="va">converter</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Print the head of the result as a data.frame</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="get_result.html">get_result</a></span><span class="op">(</span><span class="va">cw</span>, <span class="st">"data.frame"</span><span class="op">)</span>, <span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     data model_input model_output feature output_node        value pred</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 data_1     Input_1     Output_1     Car          Y1  0.137122899   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 data_1     Input_1     Output_1     Cat          Y1  0.015695198   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 data_1     Input_1     Output_1     Dog          Y1 -0.090402335   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 data_1     Input_1     Output_1   Plane          Y1 -0.007598682   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 data_1     Input_1     Output_1   Horse          Y1  0.221942976   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   decomp_sum decomp_goal input_dimension</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  0.2767601          NA               1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  0.2767601          NA               1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  0.2767601          NA               1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  0.2767601          NA               1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  0.2767601          NA               1</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Plot the result</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cw</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="ConnectionWeights-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#----------------------- Example 2: Neuralnet ------------------------------</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://github.com/bips-hb/neuralnet" class="external-link">"neuralnet"</a></span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bips-hb/neuralnet" class="external-link">neuralnet</a></span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Train a Neural Network</span></span></span>
<span class="r-in"><span>  <span class="va">nn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/neuralnet/man/neuralnet.html" class="external-link">neuralnet</a></span><span class="op">(</span><span class="op">(</span><span class="va">Species</span> <span class="op">==</span> <span class="st">"setosa"</span><span class="op">)</span> <span class="op">~</span> <span class="va">Petal.Length</span> <span class="op">+</span> <span class="va">Petal.Width</span>,</span></span>
<span class="r-in"><span>    <span class="va">iris</span>,</span></span>
<span class="r-in"><span>    linear.output <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>    hidden <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span>, act.fct <span class="op">=</span> <span class="st">"tanh"</span>, rep <span class="op">=</span> <span class="fl">1</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Convert the trained model</span></span></span>
<span class="r-in"><span>  <span class="va">converter</span> <span class="op">&lt;-</span> <span class="fu"><a href="innsight_sugar.html">convert</a></span><span class="op">(</span><span class="va">nn</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Apply the Connection Weights method</span></span></span>
<span class="r-in"><span>  <span class="va">cw</span> <span class="op">&lt;-</span> <span class="fu"><a href="innsight_sugar.html">run_cw</a></span><span class="op">(</span><span class="va">converter</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Get the result as a torch tensor</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="get_result.html">get_result</a></span><span class="op">(</span><span class="va">cw</span>, type <span class="op">=</span> <span class="st">"torch.tensor"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Plot the result</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cw</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: neuralnet</span>
<span class="r-plt img"><img src="ConnectionWeights-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># ------------------------- Example 3: Keras -------------------------------</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://tensorflow.rstudio.com/" class="external-link">"keras"</a></span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu">keras</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/keras/man/is_keras_available.html" class="external-link">is_keras_available</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tensorflow.rstudio.com/" class="external-link">keras</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Make sure keras is installed properly</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/pkg/keras/man/is_keras_available.html" class="external-link">is_keras_available</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">10</span> <span class="op">*</span> <span class="fl">32</span> <span class="op">*</span> <span class="fl">32</span> <span class="op">*</span> <span class="fl">3</span><span class="op">)</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">32</span>, <span class="fl">32</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/keras/man/keras_model_sequential.html" class="external-link">keras_model_sequential</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">model</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_conv_2d.html" class="external-link">layer_conv_2d</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>      input_shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">32</span>, <span class="fl">32</span>, <span class="fl">3</span><span class="op">)</span>, kernel_size <span class="op">=</span> <span class="fl">8</span>, filters <span class="op">=</span> <span class="fl">8</span>,</span></span>
<span class="r-in"><span>      activation <span class="op">=</span> <span class="st">"softplus"</span>, padding <span class="op">=</span> <span class="st">"valid"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_conv_2d.html" class="external-link">layer_conv_2d</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>      kernel_size <span class="op">=</span> <span class="fl">8</span>, filters <span class="op">=</span> <span class="fl">4</span>, activation <span class="op">=</span> <span class="st">"tanh"</span>,</span></span>
<span class="r-in"><span>      padding <span class="op">=</span> <span class="st">"same"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_conv_2d.html" class="external-link">layer_conv_2d</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>      kernel_size <span class="op">=</span> <span class="fl">4</span>, filters <span class="op">=</span> <span class="fl">2</span>, activation <span class="op">=</span> <span class="st">"relu"</span>,</span></span>
<span class="r-in"><span>      padding <span class="op">=</span> <span class="st">"valid"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_flatten.html" class="external-link">layer_flatten</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_dense.html" class="external-link">layer_dense</a></span><span class="op">(</span>units <span class="op">=</span> <span class="fl">64</span>, activation <span class="op">=</span> <span class="st">"relu"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_dense.html" class="external-link">layer_dense</a></span><span class="op">(</span>units <span class="op">=</span> <span class="fl">16</span>, activation <span class="op">=</span> <span class="st">"relu"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_dense.html" class="external-link">layer_dense</a></span><span class="op">(</span>units <span class="op">=</span> <span class="fl">2</span>, activation <span class="op">=</span> <span class="st">"softmax"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Convert the model</span></span></span>
<span class="r-in"><span>  <span class="va">converter</span> <span class="op">&lt;-</span> <span class="fu"><a href="innsight_sugar.html">convert</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Apply the Connection Weights method</span></span></span>
<span class="r-in"><span>  <span class="va">cw</span> <span class="op">&lt;-</span> <span class="fu"><a href="innsight_sugar.html">run_cw</a></span><span class="op">(</span><span class="va">converter</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Get the head of the result as a data.frame</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="get_result.html">get_result</a></span><span class="op">(</span><span class="va">cw</span>, type <span class="op">=</span> <span class="st">"data.frame"</span><span class="op">)</span>, <span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Plot the result for all classes</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cw</span>, output_idx <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: keras</span>
<span class="r-plt img"><img src="ConnectionWeights-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co">#------------------------- Plotly plots ------------------------------------</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://plotly-r.com" class="external-link">"plotly"</a></span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="co"># You can also create an interactive plot with plotly.</span></span></span>
<span class="r-in"><span>  <span class="co"># This is a suggested package, so make sure that it is installed</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://plotly-r.com" class="external-link">plotly</a></span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cw</span>, as_plotly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: plotly</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: ggplot2</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Attaching package: ‘plotly’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following object is masked from ‘package:ggplot2’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     last_plot</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following object is masked from ‘package:stats’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     filter</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following object is masked from ‘package:graphics’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     layout</span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Niklas Koenen.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer></div>






  </body></html>

