<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Local interpretable model-agnostic explanations (LIME) — LIME • innsight</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Local interpretable model-agnostic explanations (LIME) — LIME"><meta property="og:description" content="The R6 class LIME calculates the feature weights of a linear surrogate of
the prediction model for a instance to be explained, namely the
local interpretable model-agnostic explanations (LIME). It is a
model-agnostic method that can be applied to any predictive model.
This means, in particular, that
LIME can be applied not only to objects of the Converter class but
also to any other model. The only requirement is the argument pred_fun,
which generates predictions with the model for given data. However, this
function is pre-implemented for models created with
nn_sequential, keras_model,
neuralnet or Converter. Internally, the
suggested package lime is utilized and applied to data.frame.
The R6 class can also be initialized using the run_lime function
as a helper function so that no prior knowledge of R6 classes is required.
Note: Even signal and image data are initially transformed into a
data.frame using as.data.frame() and then lime::lime and
lime::explain are
applied. In other words, a custom pred_fun may need to convert the
data.frame back into an array as necessary."><meta property="og:image" content="https://bips-hb.github.io/innsight/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">innsight</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.3.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/innsight.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/detailed_overview.html">In-depth explanation</a>
    </li>
    <li>
      <a href="../articles/Example_1_iris.html">Example 1: Iris dataset with torch</a>
    </li>
    <li>
      <a href="../articles/Example_2_penguin.html">Example 2: Penguin dataset with torch and luz</a>
    </li>
    <li>
      <a href="../articles/Example_3_imagenet.html">Example 3: ImageNet with keras</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/bips-hb/innsight/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Local interpretable model-agnostic explanations (LIME)</h1>
    <small class="dont-index">Source: <a href="https://github.com/bips-hb/innsight/blob/master/R/AgnosticMethods.R" class="external-link"><code>R/AgnosticMethods.R</code></a></small>
    <div class="hidden name"><code>LIME.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>The R6 class <code>LIME</code> calculates the feature weights of a linear surrogate of
the prediction model for a instance to be explained, namely the
<em>local interpretable model-agnostic explanations (LIME)</em>. It is a
model-agnostic method that can be applied to any predictive model.
This means, in particular, that
<code>LIME</code> can be applied not only to objects of the <code><a href="Converter.html">Converter</a></code> class but
also to any other model. The only requirement is the argument <code>pred_fun</code>,
which generates predictions with the model for given data. However, this
function is pre-implemented for models created with
<code><a href="https://torch.mlverse.org/docs/reference/nn_sequential.html" class="external-link">nn_sequential</a></code>, <code><a href="https://rdrr.io/pkg/keras/man/keras_model.html" class="external-link">keras_model</a></code>,
<code><a href="https://rdrr.io/pkg/neuralnet/man/neuralnet.html" class="external-link">neuralnet</a></code> or <code><a href="Converter.html">Converter</a></code>. Internally, the
suggested package <code>lime</code> is utilized and applied to <code>data.frame</code>.</p>
<p>The R6 class can also be initialized using the <code><a href="innsight_sugar.html">run_lime</a></code> function
as a helper function so that no prior knowledge of R6 classes is required.</p>
<p><strong>Note:</strong> Even signal and image data are initially transformed into a
<code>data.frame</code> using <code><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame()</a></code> and then <code><a href="https://lime.data-imaginist.com/reference/lime.html" class="external-link">lime::lime</a></code> and
<code><a href="https://lime.data-imaginist.com/reference/explain.html" class="external-link">lime::explain</a></code> are
applied. In other words, a custom <code>pred_fun</code> may need to convert the
<code>data.frame</code> back into an <code>array</code> as necessary.</p>
    </div>


    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>Other methods:
<code><a href="ConnectionWeights.html">ConnectionWeights</a></code>,
<code><a href="DeepLift.html">DeepLift</a></code>,
<code><a href="DeepSHAP.html">DeepSHAP</a></code>,
<code><a href="ExpectedGradient.html">ExpectedGradient</a></code>,
<code><a href="Gradient.html">Gradient</a></code>,
<code><a href="IntegratedGradient.html">IntegratedGradient</a></code>,
<code><a href="LRP.html">LRP</a></code>,
<code><a href="SHAP.html">SHAP</a></code>,
<code><a href="SmoothGrad.html">SmoothGrad</a></code></p></div>
    </div>
    <div id="super-classes">
    <h2>Super classes</h2>
    <p><code><a href="InterpretingMethod.html">innsight::InterpretingMethod</a></code> -&gt; <code><a href="AgnosticWrapper.html">innsight::AgnosticWrapper</a></code> -&gt; <code>LIME</code></p>
    </div>
    <div id="methods">
    <h2>Methods</h2>

<div class="section">
<h3 id="public-methods">Public methods<a class="anchor" aria-label="anchor" href="#public-methods"></a></h3>

<ul><li><p><a href="#method-LIME-new"><code>LIME$new()</code></a></p></li>
<li><p><a href="#method-LIME-clone"><code>LIME$clone()</code></a></p></li>
</ul></div><p><details open><summary>Inherited methods</summary><ul><li><span class="pkg-link" data-pkg="innsight" data-topic="InterpretingMethod" data-id="get_result"><a href="InterpretingMethod.html#method-get_result"><code>innsight::InterpretingMethod$get_result()</code></a></span></li>
<li><span class="pkg-link" data-pkg="innsight" data-topic="InterpretingMethod" data-id="plot"><a href="InterpretingMethod.html#method-plot"><code>innsight::InterpretingMethod$plot()</code></a></span></li>
<li><span class="pkg-link" data-pkg="innsight" data-topic="InterpretingMethod" data-id="plot_global"><a href="InterpretingMethod.html#method-plot_global"><code>innsight::InterpretingMethod$plot_global()</code></a></span></li>
<li><span class="pkg-link" data-pkg="innsight" data-topic="InterpretingMethod" data-id="print"><a href="InterpretingMethod.html#method-print"><code>innsight::InterpretingMethod$print()</code></a></span></li>
</ul></details></p><hr><a id="method-LIME-new"></a><div class="section">
<h3 id="method-new-">Method <code>new()</code><a class="anchor" aria-label="anchor" href="#method-new-"></a></h3>
<p>Create a new instance of the <code>LIME</code> R6 class. When initialized,
the method <em>LIME</em> is applied to the given data and the results are
stored in the field <code>result</code>.</p><div class="section">
<h4 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va"><a href="../reference/LIME.html">LIME</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  <span class="va">model</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">data_ref</span>,</span>
<span>  output_type <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pred_fun <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  output_idx <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  output_label <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  channels_first <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  input_dim <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  input_names <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  output_names <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h4>
<p></p><div class="arguments"><dl><dt><code>model</code></dt>
<dd><p>(any prediction model)<br>
A fitted model for a classification or regression task that
is intended to be interpreted. A <code><a href="Converter.html">Converter</a></code> object can also be
passed. In order for the package to know how to make predictions
with the given model, a prediction function must also be passed with
the argument <code>pred_fun</code>. However, for models created by
<code><a href="https://torch.mlverse.org/docs/reference/nn_sequential.html" class="external-link">nn_sequential</a></code>, <code><a href="https://rdrr.io/pkg/keras/man/keras_model.html" class="external-link">keras_model</a></code>,
<code><a href="https://rdrr.io/pkg/neuralnet/man/neuralnet.html" class="external-link">neuralnet</a></code> or <code><a href="Converter.html">Converter</a></code>,
these have already been pre-implemented and do not need to be
specified.<br></p></dd>


<dt><code>data</code></dt>
<dd><p>(<code>array</code>, <code>data.frame</code> or <code>torch_tensor</code>)<br>
The individual instances to be explained by the method.
These must have the same format as the input data of the passed model
and has to be either <code><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></code>, an <code><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></code>, a <code><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></code> or a
<code><a href="https://torch.mlverse.org/docs/reference/torch_tensor.html" class="external-link">torch_tensor</a></code>. If no value is specified, all instances in the
dataset <code>data</code> will be explained.<br><strong>Note:</strong> For the model-agnostic methods, only models with a single
input and output layer is allowed!<br></p></dd>


<dt><code>data_ref</code></dt>
<dd><p>(<code><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></code>, <code><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></code> or <code><a href="https://torch.mlverse.org/docs/reference/torch_tensor.html" class="external-link">torch_tensor</a></code>)<br>
The dataset to which the method is to be applied. These must
have the same format as the input data of the passed model and has to
be either <code><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></code>, an <code><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></code>, a <code><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></code> or a
<code><a href="https://torch.mlverse.org/docs/reference/torch_tensor.html" class="external-link">torch_tensor</a></code>.<br><strong>Note:</strong> For the model-agnostic methods, only models with a single
input and output layer is allowed!<br></p></dd>


<dt><code>output_type</code></dt>
<dd><p>(<code>character(1)</code>)<br>
Type of the model output, i.e., either
<code>"classification"</code> or <code>"regression"</code>.<br></p></dd>


<dt><code>pred_fun</code></dt>
<dd><p>(<code>function</code>)<br>
Prediction function for the model. This argument is only
needed if <code>model</code> is not a model created by
<code><a href="https://torch.mlverse.org/docs/reference/nn_sequential.html" class="external-link">nn_sequential</a></code>, <code><a href="https://rdrr.io/pkg/keras/man/keras_model.html" class="external-link">keras_model</a></code>,
<code><a href="https://rdrr.io/pkg/neuralnet/man/neuralnet.html" class="external-link">neuralnet</a></code> or <code><a href="Converter.html">Converter</a></code>. The first argument of
<code>pred_fun</code> has to be <code>newdata</code>, e.g.,</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="cf">function</span>(newdata, ...) <span class="fu">model</span>(newdata)</span></code></pre><p></p></div></dd>


<dt><code>output_idx</code></dt>
<dd><p>(<code>integer</code>, <code>list</code> or <code>NULL</code>)<br>
These indices specify the output nodes for which
the method is to be applied. In order to allow models with multiple
output layers, there are the following possibilities to select
the indices of the output nodes in the individual output layers:</p><ul><li><p>An <code>integer</code> vector of indices: If the model has only one output
layer, the values correspond to the indices of the output nodes, e.g.,
<code>c(1,3,4)</code> for the first, third and fourth output node. If there are
multiple output layers, the indices of the output nodes from the first
output layer are considered.</p></li>
<li><p>A <code>list</code> of <code>integer</code> vectors of indices: If the method is to be
applied to output nodes from different layers, a list can be passed
that specifies the desired indices of the output nodes for each
output layer. Unwanted output layers have the entry <code>NULL</code> instead of
a vector of indices, e.g., <code>list(NULL, c(1,3))</code> for the first and
third output node in the second output layer.</p></li>
<li><p><code>NULL</code> (default): The method is applied to all output nodes in
the first output layer but is limited to the first ten as the
calculations become more computationally expensive for more output
nodes.<br></p></li>
</ul></dd>


<dt><code>output_label</code></dt>
<dd><p>(<code>character</code>, <code>factor</code>, <code>list</code> or <code>NULL</code>)<br>
These values specify the output nodes for which
the method is to be applied. Only values that were previously passed with
the argument <code>output_names</code> in the <code>converter</code> can be used. In order to
allow models with multiple
output layers, there are the following possibilities to select
the names of the output nodes in the individual output layers:</p><ul><li><p>A <code>character</code> vector or <code>factor</code> of labels: If the model has only one output
layer, the values correspond to the labels of the output nodes named in the
passed <code>Converter</code> object, e.g.,
<code>c("a", "c", "d")</code> for the first, third and fourth output node if the
output names are <code>c("a", "b", "c", "d")</code>. If there are
multiple output layers, the names of the output nodes from the first
output layer are considered.</p></li>
<li><p>A <code>list</code> of <code>charactor</code>/<code>factor</code> vectors of labels: If the method is to be
applied to output nodes from different layers, a list can be passed
that specifies the desired labels of the output nodes for each
output layer. Unwanted output layers have the entry <code>NULL</code> instead of
a vector of labels, e.g., <code>list(NULL, c("a", "c"))</code> for the first and
third output node in the second output layer.</p></li>
<li><p><code>NULL</code> (default): The method is applied to all output nodes in
the first output layer but is limited to the first ten as the
calculations become more computationally expensive for more output
nodes.<br></p></li>
</ul></dd>


<dt><code>channels_first</code></dt>
<dd><p>(<code>logical(1)</code>)<br>
The channel position of the given data (argument
<code>data</code>). If <code>TRUE</code>, the channel axis is placed at the second position
between the batch size and the rest of the input axes, e.g.,
<code>c(10,3,32,32)</code> for a batch of ten images with three channels and a
height and width of 32 pixels. Otherwise (<code>FALSE</code>), the channel axis
is at the last position, i.e., <code>c(10,32,32,3)</code>. If the data
has no channel axis, use the default value <code>TRUE</code>.<br></p></dd>


<dt><code>input_dim</code></dt>
<dd><p>(<code>integer</code>)<br>
The model input dimension excluding the batch
dimension. It can be specified as vector of integers, but has to be in
the format "channels first".<br></p></dd>


<dt><code>input_names</code></dt>
<dd><p>(<code>character</code>, <code>factor</code> or <code>list</code>)<br>
The input names of the model excluding the batch dimension. For a model
with a single input layer and input axis (e.g., for tabular data), the
input names can be specified as a character vector or factor, e.g.,
for a dense layer with 3 input features use <code>c("X1", "X2", "X3")</code>. If
the model input consists of multiple axes (e.g., for signal and
image data), use a list of character vectors or factors for each axis
in the format "channels first", e.g., use
<code>list(c("C1", "C2"), c("L1","L2","L3","L4","L5"))</code> for a 1D
convolutional input layer with signal length 4 and 2 channels.<br><em>Note:</em> This argument is optional and otherwise the names are
generated automatically. But if this argument is set, all found
input names in the passed model will be disregarded.<br></p></dd>


<dt><code>output_names</code></dt>
<dd><p>(<code>character</code>, <code>factor</code> )<br>
A character vector with the names for the output dimensions
excluding the batch dimension, e.g., for a model with 3 output nodes use
<code>c("Y1", "Y2", "Y3")</code>. Instead of a character
vector you can also use a factor to set an order for the plots.<br><em>Note:</em> This argument is optional and otherwise the names are
generated automatically. But if this argument is set, all found
output names in the passed model will be disregarded.<br></p></dd>


<dt><code>...</code></dt>
<dd><p>other arguments forwarded to <code><a href="https://lime.data-imaginist.com/reference/explain.html" class="external-link">lime::explain</a></code>.</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-LIME-clone"></a><div class="section">
<h3 id="method-clone-">Method <code>clone()</code><a class="anchor" aria-label="anchor" href="#method-clone-"></a></h3>
<p>The objects of this class are cloneable with this method.</p><div class="section">
<h4 id="usage-1">Usage<a class="anchor" aria-label="anchor" href="#usage-1"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">LIME</span><span class="op">$</span><span class="fu">clone</span><span class="op">(</span>deep <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-1">Arguments<a class="anchor" aria-label="anchor" href="#arguments-1"></a></h4>
<p></p><div class="arguments"><dl><dt><code>deep</code></dt>
<dd><p>Whether to make a deep clone.</p></dd>


</dl><p></p></div>
</div>

</div>

    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">#----------------------- Example 1: Torch -----------------------------------</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://torch.mlverse.org/docs" class="external-link">torch</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create nn_sequential model and data</span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torch.mlverse.org/docs/reference/nn_sequential.html" class="external-link">nn_sequential</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://torch.mlverse.org/docs/reference/nn_linear.html" class="external-link">nn_linear</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">12</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://torch.mlverse.org/docs/reference/nn_relu.html" class="external-link">nn_relu</a></span><span class="op">(</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://torch.mlverse.org/docs/reference/nn_linear.html" class="external-link">nn_linear</a></span><span class="op">(</span><span class="fl">12</span>, <span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://torch.mlverse.org/docs/reference/nn_softmax.html" class="external-link">nn_softmax</a></span><span class="op">(</span>dim <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torch.mlverse.org/docs/reference/torch_randn.html" class="external-link">torch_randn</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate LIME for the first 10 instances and set the</span></span></span>
<span class="r-in"><span><span class="co"># feature and outcome names</span></span></span>
<span class="r-in"><span><span class="va">lime</span> <span class="op">&lt;-</span> <span class="va">LIME</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">model</span>, <span class="va">data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="op">]</span>, data_ref <span class="op">=</span> <span class="va">data</span>,</span></span>
<span class="r-in"><span>                 input_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Car"</span>, <span class="st">"Cat"</span>, <span class="st">"Dog"</span>, <span class="st">"Plane"</span>, <span class="st">"Horse"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                 output_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Buy it!"</span>, <span class="st">"Don't buy it!"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># You can also use the helper function `run_lime` for initializing</span></span></span>
<span class="r-in"><span><span class="co"># an R6 LIME object</span></span></span>
<span class="r-in"><span><span class="va">lime</span> <span class="op">&lt;-</span> <span class="fu"><a href="innsight_sugar.html">run_lime</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="op">]</span>, data_ref <span class="op">=</span> <span class="va">data</span>,</span></span>
<span class="r-in"><span>                 input_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Car"</span>, <span class="st">"Cat"</span>, <span class="st">"Dog"</span>, <span class="st">"Plane"</span>, <span class="st">"Horse"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                 output_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Buy it!"</span>, <span class="st">"Don't buy it!"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Get the result as an array for the first two instances</span></span></span>
<span class="r-in"><span><span class="fu"><a href="get_result.html">get_result</a></span><span class="op">(</span><span class="va">lime</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>,, <span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> , , Buy it!</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               Car         Cat        Dog       Plane       Horse</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] -0.018419232  0.01915762  0.0256181 -0.02024414  0.12926322</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] -0.004557014 -0.02365922 -0.0969191  0.04440350 -0.00397498</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> , , Don't buy it!</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              Car         Cat        Dog       Plane        Horse</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 0.018419232 -0.01915762 -0.0256181  0.02024414 -0.129263222</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] 0.004557013  0.02365922  0.0969191 -0.04440350  0.003974979</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Plot the result for both classes</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">lime</span>, output_idx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="LIME-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Show the boxplot over all 10 instances</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">lime</span>, output_idx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="LIME-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># We can also forward some arguments to lime::explain, e.g. n_permutatuins</span></span></span>
<span class="r-in"><span><span class="co"># to get more accurate values</span></span></span>
<span class="r-in"><span><span class="va">lime</span> <span class="op">&lt;-</span> <span class="fu"><a href="innsight_sugar.html">run_lime</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="op">]</span>, data_ref <span class="op">=</span> <span class="va">data</span>,</span></span>
<span class="r-in"><span>                 input_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Car"</span>, <span class="st">"Cat"</span>, <span class="st">"Dog"</span>, <span class="st">"Plane"</span>, <span class="st">"Horse"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                 output_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Buy it!"</span>, <span class="st">"Don't buy it!"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                 n_perturbations <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Plot the boxplots again</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">lime</span>, output_idx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="LIME-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#----------------------- Example 2: Converter object --------------------------</span></span></span>
<span class="r-in"><span><span class="co"># We can do the same with an Converter object (all feature and outcome names</span></span></span>
<span class="r-in"><span><span class="co"># will be extracted by the LIME method!)</span></span></span>
<span class="r-in"><span><span class="va">conv</span> <span class="op">&lt;-</span> <span class="fu"><a href="innsight_sugar.html">convert</a></span><span class="op">(</span><span class="va">model</span>,</span></span>
<span class="r-in"><span>                input_dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                input_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Car"</span>, <span class="st">"Cat"</span>, <span class="st">"Dog"</span>, <span class="st">"Plane"</span>, <span class="st">"Horse"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                output_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Buy it!"</span>, <span class="st">"Don't buy it!"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate LIME for the first 10 instances</span></span></span>
<span class="r-in"><span><span class="va">lime</span> <span class="op">&lt;-</span> <span class="fu"><a href="innsight_sugar.html">run_lime</a></span><span class="op">(</span><span class="va">conv</span>, <span class="va">data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>, data_ref <span class="op">=</span> <span class="va">data</span>, n_perturbations <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Plot the result for both classes</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">lime</span>, output_idx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="LIME-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#----------------------- Example 3: Other model -------------------------------</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://github.com/bips-hb/neuralnet" class="external-link">"neuralnet"</a></span><span class="op">)</span> <span class="op">&amp;</span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://imbs-hl.github.io/ranger/" class="external-link">"ranger"</a></span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bips-hb/neuralnet" class="external-link">neuralnet</a></span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://imbs-hl.github.io/ranger/" class="external-link">ranger</a></span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Fit a random forest unsing the ranger package</span></span></span>
<span class="r-in"><span>  <span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://imbs-hl.github.io/ranger/reference/ranger.html" class="external-link">ranger</a></span><span class="op">(</span><span class="va">Species</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">iris</span>, probability <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># There is no pre-implemented predict function for ranger models, i.e.,</span></span></span>
<span class="r-in"><span>  <span class="co"># we have to define it ourselves.</span></span></span>
<span class="r-in"><span>  <span class="va">pred_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">newdata</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">newdata</span>, <span class="va">...</span><span class="op">)</span><span class="op">$</span><span class="va">predictions</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Calculate LIME for the instances of index 1 and 111 and add</span></span></span>
<span class="r-in"><span>  <span class="co"># the outcome labels (for LIME, the output_type is required!)</span></span></span>
<span class="r-in"><span>  <span class="va">lime</span> <span class="op">&lt;-</span> <span class="fu"><a href="innsight_sugar.html">run_lime</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">iris</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">111</span><span class="op">)</span>, <span class="op">-</span><span class="fl">5</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>                   data_ref <span class="op">=</span> <span class="va">iris</span><span class="op">[</span>, <span class="op">-</span><span class="fl">5</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>                   pred_fun <span class="op">=</span> <span class="va">pred_fun</span>,</span></span>
<span class="r-in"><span>                   output_type <span class="op">=</span> <span class="st">"classification"</span>,</span></span>
<span class="r-in"><span>                   output_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">iris</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                   n_perturbations <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Plot the result for the first two classes and all selected instances</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">lime</span>, data_idx <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, output_idx <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Get the result as a torch_tensor</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="get_result.html">get_result</a></span><span class="op">(</span><span class="va">lime</span>, <span class="st">"torch_tensor"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: ranger</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> torch_tensor</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (1,.,.) = </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0.0314 -0.0109 -0.0205</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0.0221 -0.0071 -0.0150</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0.4255 -0.1990 -0.2263</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0.3813 -0.1826 -0.1986</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (2,.,.) = </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  -0.0240 -0.0230  0.0470</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0.0011  0.0154 -0.0165</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  -0.2090  0.2022  0.0067</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  -0.2279 -0.1833  0.4112</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [ CPUFloatType{2,4,3} ]</span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Niklas Koenen.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer></div>






  </body></html>

