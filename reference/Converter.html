<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Converter of an artificial neural network — Converter • innsight</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Converter of an artificial neural network — Converter"><meta property="og:description" content='This class analyzes a passed neural network and stores its internal
structure and the individual layers by converting the entire network into an
nn_module. With the help of this converter, many
methods for interpreting the behavior of neural networks are provided, which
give a better understanding of the whole model or individual predictions.
You can use models from the following libraries:
torch (nn_sequential)
keras (keras_model,
keras_model_sequential),
neuralnet


Furthermore, a model can be passed as a list (see
vignette("detailed_overview", package = "innsight") or the
website).
The R6 class can also be initialized using the convert function
as a helper function so that no prior knowledge of R6 classes is required.'><meta property="og:image" content="https://bips-hb.github.io/innsight/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">innsight</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.3.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/innsight.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/detailed_overview.html">In-depth explanation</a>
    </li>
    <li>
      <a href="../articles/Example_1_iris.html">Example 1: Iris dataset with torch</a>
    </li>
    <li>
      <a href="../articles/Example_2_penguin.html">Example 2: Penguin dataset with torch and luz</a>
    </li>
    <li>
      <a href="../articles/Example_3_imagenet.html">Example 3: ImageNet with keras</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/bips-hb/innsight/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Converter of an artificial neural network</h1>
    <small class="dont-index">Source: <a href="https://github.com/bips-hb/innsight/blob/master/R/Converter.R" class="external-link"><code>R/Converter.R</code></a></small>
    <div class="hidden name"><code>Converter.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This class analyzes a passed neural network and stores its internal
structure and the individual layers by converting the entire network into an
<code><a href="https://torch.mlverse.org/docs/reference/nn_module.html" class="external-link">nn_module</a></code>. With the help of this converter, many
methods for interpreting the behavior of neural networks are provided, which
give a better understanding of the whole model or individual predictions.
You can use models from the following libraries:</p><ul><li><p><code>torch</code> (<code><a href="https://torch.mlverse.org/docs/reference/nn_sequential.html" class="external-link">nn_sequential</a></code>)</p></li>
<li><p><code><a href="https://rdrr.io/pkg/keras/man/keras.html" class="external-link">keras</a></code> (<code><a href="https://rdrr.io/pkg/keras/man/keras_model.html" class="external-link">keras_model</a></code>,
<code><a href="https://rdrr.io/pkg/keras/man/keras_model_sequential.html" class="external-link">keras_model_sequential</a></code>),</p></li>
<li><p><code><a href="https://rdrr.io/pkg/neuralnet/man/neuralnet.html" class="external-link">neuralnet</a></code></p></li>
</ul><p>Furthermore, a model can be passed as a list (see
<code><a href="../articles/detailed_overview.html">vignette("detailed_overview", package = "innsight")</a></code> or the
<a href="https://bips-hb.github.io/innsight/articles/detailed_overview.html#model-as-named-list">website</a>).</p>
<p>The R6 class can also be initialized using the <code><a href="innsight_sugar.html">convert</a></code> function
as a helper function so that no prior knowledge of R6 classes is required.</p>
    </div>


    <div id="details">
    <h2>Details</h2>
    <p>In order to better understand and analyze the prediction of a neural
network, the preactivation or other information of the individual layers,
which are not stored in an ordinary forward pass, are often required. For
this reason, a given neural network is converted into a torch-based neural
network, which provides all the necessary information for an interpretation.
The converted torch model is stored in the field <code>model</code> and is an instance
of <code><a href="ConvertedModel.html">ConvertedModel</a></code>.
However, before the torch model is created, all relevant details of the
passed model are extracted into a named list. This list can be saved
in complete form in the <code>model_as_list</code> field with the argument
<code>save_model_as_list</code>, but this may consume a lot of memory for large
networks and is not done by default. Also, this named list can again be
used as a passed model for the class <code>Converter</code>, which will be described
in more detail in the section 'Implemented Libraries'.</p><div class="section">
<h3 id="implemented-methods">Implemented methods<a class="anchor" aria-label="anchor" href="#implemented-methods"></a></h3>


<p>An object of the Converter class can be applied to the
following methods:</p><ul><li><p><em>Layerwise Relevance Propagation</em> (<a href="LRP.html">LRP</a>), Bach et al. (2015)</p></li>
<li><p><em>Deep Learning Important Features</em> (<a href="DeepLift.html">DeepLift</a>), Shrikumar et al. (2017)</p></li>
<li><p><em><a href="DeepSHAP.html">DeepSHAP</a></em>, Lundberg et al. (2017)</p></li>
<li><p><em><a href="SmoothGrad.html">SmoothGrad</a></em> including <em>SmoothGrad\(\times\)Input</em>, Smilkov et al. (2017)</p></li>
<li><p><em>Vanilla <a href="Gradient.html">Gradient</a></em> including <em>Gradient\(\times\)Input</em></p></li>
<li><p><em>Integrated gradients</em> (<a href="IntegratedGradient.html">IntegratedGradient</a>), Sundararajan et al. (2017)</p></li>
<li><p><em>Expected gradients</em> (<a href="ExpectedGradient.html">ExpectedGradient</a>), Erion et al. (2021)</p></li>
<li><p><em><a href="ConnectionWeights.html">ConnectionWeights</a></em>, Olden et al. (2004)</p></li>
<li><p><em>Local interpretable model-agnostic explanation (<a href="LIME.html">LIME</a>)</em>, Ribeiro et al. (2016)</p></li>
<li><p><em>Shapley values (<a href="SHAP.html">SHAP</a>)</em>, Lundberg et al. (2017)</p></li>
</ul></div>

<div class="section">
<h3 id="implemented-libraries">Implemented libraries<a class="anchor" aria-label="anchor" href="#implemented-libraries"></a></h3>


<p>The converter is implemented for models from the libraries
<code><a href="https://torch.mlverse.org/docs/reference/nn_sequential.html" class="external-link">nn_sequential</a></code>,
<code><a href="https://rdrr.io/pkg/neuralnet/man/neuralnet.html" class="external-link">neuralnet</a></code> and <code><a href="https://rdrr.io/pkg/keras/man/keras.html" class="external-link">keras</a></code>. But you
can also write a wrapper for other libraries because a model can be passed
as a named list which is described in detail in the vignette "In-depth
explanation" <br>
(see <code><a href="../articles/detailed_overview.html">vignette("detailed_overview", package = "innsight")</a></code> or the
<a href="https://bips-hb.github.io/innsight/articles/detailed_overview.html#model-as-named-list">website</a>).</p>
</div>

    </div>
    <div id="references">
    <h2>References</h2>

<ul><li><p>J. D. Olden et al. (2004) <em>An accurate comparison of methods for
quantifying variable importance in artificial neural networks using
simulated data.</em> Ecological Modelling 178, p. 389–397</p></li>
<li><p>S. Bach et al. (2015) <em>On pixel-wise explanations for non-linear
classifier decisions by layer-wise relevance propagation.</em> PLoS ONE 10,
p. 1-46</p></li>
<li><p>M. T. Ribeiro et al. (2016) <em>"Why should I trust you?": Explaining
the predictions of any classifier.</em> KDD 2016, p. 1135-1144</p></li>
<li><p>A. Shrikumar et al. (2017) <em>Learning important features through
propagating activation differences.</em>  ICML 2017, p. 4844-4866</p></li>
<li><p>D. Smilkov et al. (2017) <em>SmoothGrad: removing noise by adding noise.</em>
CoRR, abs/1706.03825
M. Sundararajan et al. (2017) <em>Axiomatic attribution for deep networks.</em>
ICML 2017, p.3319-3328</p></li>
<li><p>S. Lundberg et al. (2017) <em>A unified approach to interpreting model
predictions.</em> NIPS 2017, p. 4768-4777</p></li>
<li><p>G. Erion et al. (2021) <em>Improving performance of deep learning models
with axiomatic attribution priors and expected gradients.</em> Nature Machine
Intelligence 3, p. 620-631</p></li>
</ul></div>
    <div id="public-fields">
    <h2>Public fields</h2>
    <p></p><div class="r6-fields"><dl><dt><code>model</code></dt>
<dd><p>(<code><a href="ConvertedModel.html">ConvertedModel</a></code>)<br>
The converted neural network based on the torch module <a href="ConvertedModel.html">ConvertedModel</a>.<br></p></dd>


<dt><code>input_dim</code></dt>
<dd><p>(<code>list</code>)<br>
A list of the input dimensions of each input layer. Since
internally the "channels first" format is used for all calculations, the
input shapes are already in this format. In addition, the batch
dimension isn't included, e.g., for an input layer of shape <code>c(*,32,32,3)</code>
with channels in the last axis you get <code>list(c(3,32,32))</code>.<br></p></dd>


<dt><code>input_names</code></dt>
<dd><p>(<code>list</code>)<br>
A list with the names as factors for each input
dimension of the shape as stored in the field <code>input_dim</code>.<br></p></dd>


<dt><code>output_dim</code></dt>
<dd><p>(<code>list</code>)<br>
A list of the output dimensions of each output layer.<br></p></dd>


<dt><code>output_names</code></dt>
<dd><p>(<code>list</code>)<br> A list with the names as factors for each
output dimension of shape as stored in the field <code>output_dim</code>.<br></p></dd>


<dt><code>model_as_list</code></dt>
<dd><p>(<code>list</code>)<br>
The model stored in a named list (see details for more
information). By default, the entry <code>model_as_list$layers</code> is deleted
because it may require a lot of memory for large networks. However, with
the argument <code>save_model_as_list</code> this can be saved anyway.<br></p></dd>


</dl><p></p></div>
    </div>
    <div id="methods">
    <h2>Methods</h2>

<div class="section">
<h3 id="public-methods">Public methods<a class="anchor" aria-label="anchor" href="#public-methods"></a></h3>

<ul><li><p><a href="#method-Converter-new"><code>Converter$new()</code></a></p></li>
<li><p><a href="#method-Converter-print"><code>Converter$print()</code></a></p></li>
<li><p><a href="#method-Converter-clone"><code>Converter$clone()</code></a></p></li>
</ul></div><p></p><hr><a id="method-Converter-new"></a><div class="section">
<h3 id="method-new-">Method <code>new()</code><a class="anchor" aria-label="anchor" href="#method-new-"></a></h3>
<p>Create a new Converter object for a given neural network. When initialized,
the model is inspected, converted as a list and then the a
torch-converted model (<a href="ConvertedModel.html">ConvertedModel</a>) is created and stored in
the field <code>model</code>.</p><div class="section">
<h4 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va"><a href="../reference/Converter.html">Converter</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  <span class="va">model</span>,</span>
<span>  input_dim <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  input_names <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  output_names <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  dtype <span class="op">=</span> <span class="st">"float"</span>,</span>
<span>  save_model_as_list <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h4>
<p></p><div class="arguments"><dl><dt><code>model</code></dt>
<dd><p>(<code><a href="https://torch.mlverse.org/docs/reference/nn_sequential.html" class="external-link">nn_sequential</a></code>,
<code><a href="https://rdrr.io/pkg/keras/man/keras_model.html" class="external-link">keras_model</a></code>,
<code><a href="https://rdrr.io/pkg/neuralnet/man/neuralnet.html" class="external-link">neuralnet</a></code> or <code>list</code>)<br>
A trained neural network for classification or regression
tasks to be interpreted. Only models from the following types or
packages are allowed: <code><a href="https://torch.mlverse.org/docs/reference/nn_sequential.html" class="external-link">nn_sequential</a></code>,
<code><a href="https://rdrr.io/pkg/keras/man/keras_model.html" class="external-link">keras_model</a></code>,
<code><a href="https://rdrr.io/pkg/keras/man/keras_model_sequential.html" class="external-link">keras_model_sequential</a></code>,
<code><a href="https://rdrr.io/pkg/neuralnet/man/neuralnet.html" class="external-link">neuralnet</a></code> or a named list (see details).</p></dd>


<dt><code>input_dim</code></dt>
<dd><p>(<code>integer</code> or <code>list</code>)<br>
The model input dimension excluding the batch
dimension. If there is only one input layer it can be specified as
a vector, otherwise use a list of the shapes of the
individual input layers.<br><em>Note:</em> This argument is only necessary for <code><a href="https://torch.mlverse.org/docs/reference/nn_sequential.html" class="external-link">torch::nn_sequential</a></code>,
for all others it is automatically extracted from the passed model
and used for internal checks. In addition, the input dimension
<code>input_dim</code> has to be in the format "channels first".<br></p></dd>


<dt><code>input_names</code></dt>
<dd><p>(<code>character</code>, <code>factor</code> or <code>list</code>)<br>
The input names of the model excluding the batch dimension. For a model
with a single input layer and input axis (e.g., for tabular data), the
input names can be specified as a character vector or factor, e.g.,
for a dense layer with 3 input features use <code>c("X1", "X2", "X3")</code>. If
the model input consists of multiple axes (e.g., for signal and
image data), use a list of character vectors or factors for each axis
in the format "channels first", e.g., use
<code>list(c("C1", "C2"), c("L1","L2","L3","L4","L5"))</code> for a 1D
convolutional input layer with signal length 4 and 2 channels. For
models with multiple input layers, use a list of the upper ones for each
layer.<br><em>Note:</em> This argument is optional and otherwise the names are
generated automatically. But if this argument is set, all found
input names in the passed model will be disregarded.<br></p></dd>


<dt><code>output_names</code></dt>
<dd><p>(<code>character</code>, <code>factor</code> or <code>list</code>)<br>
A character vector with the names for the output dimensions
excluding the batch dimension, e.g., for a model with 3 output nodes use
<code>c("Y1", "Y2", "Y3")</code>. Instead of a character
vector you can also use a factor to set an order for the plots. If the
model has multiple output layers, use a list of the upper ones.<br><em>Note:</em> This argument is optional and otherwise the names are
generated automatically. But if this argument is set, all found
output names in the passed model will be disregarded.<br></p></dd>


<dt><code>dtype</code></dt>
<dd><p>(<code>character(1)</code>)<br>
The data type for the calculations. Use
either <code>'float'</code> for <a href="https://torch.mlverse.org/docs/reference/torch_dtype.html" class="external-link">torch::torch_float</a> or <code>'double'</code> for
<a href="https://torch.mlverse.org/docs/reference/torch_dtype.html" class="external-link">torch::torch_double</a>.<br></p></dd>


<dt><code>save_model_as_list</code></dt>
<dd><p>(<code>logical(1)</code>)<br>
This logical value specifies whether the
passed model should be stored as a list. This list can take
a lot of memory for large networks, so by default the model is not
stored as a list (<code>FALSE</code>).<br></p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="returns">Returns<a class="anchor" aria-label="anchor" href="#returns"></a></h4>
<p>A new instance of the R6 class <code>Converter</code>.</p>
</div>

</div><p></p><hr><a id="method-Converter-print"></a><div class="section">
<h3 id="method-print-">Method <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code><a class="anchor" aria-label="anchor" href="#method-print-"></a></h3>
<p>Print a summary of the <code>Converter</code> object. This summary contains the
individual fields and in particular the torch-converted model
(<a href="ConvertedModel.html">ConvertedModel</a>) with the layers.</p><div class="section">
<h4 id="usage-1">Usage<a class="anchor" aria-label="anchor" href="#usage-1"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">Converter</span><span class="op">$</span><span class="fu">print</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="returns-1">Returns<a class="anchor" aria-label="anchor" href="#returns-1"></a></h4>
<p>Returns the <code>Converter</code> object invisibly via <code><a href="https://rdrr.io/r/base/invisible.html" class="external-link">base::invisible</a></code>.</p>
</div>

</div><p></p><hr><a id="method-Converter-clone"></a><div class="section">
<h3 id="method-clone-">Method <code>clone()</code><a class="anchor" aria-label="anchor" href="#method-clone-"></a></h3>
<p>The objects of this class are cloneable with this method.</p><div class="section">
<h4 id="usage-2">Usage<a class="anchor" aria-label="anchor" href="#usage-2"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">Converter</span><span class="op">$</span><span class="fu">clone</span><span class="op">(</span>deep <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-1">Arguments<a class="anchor" aria-label="anchor" href="#arguments-1"></a></h4>
<p></p><div class="arguments"><dl><dt><code>deep</code></dt>
<dd><p>Whether to make a deep clone.</p></dd>


</dl><p></p></div>
</div>

</div>

    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">#----------------------- Example 1: Torch ----------------------------------</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://torch.mlverse.org/docs" class="external-link">torch</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torch.mlverse.org/docs/reference/nn_sequential.html" class="external-link">nn_sequential</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://torch.mlverse.org/docs/reference/nn_linear.html" class="external-link">nn_linear</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://torch.mlverse.org/docs/reference/nn_relu.html" class="external-link">nn_relu</a></span><span class="op">(</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://torch.mlverse.org/docs/reference/nn_linear.html" class="external-link">nn_linear</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">2</span>, bias <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://torch.mlverse.org/docs/reference/nn_softmax.html" class="external-link">nn_softmax</a></span><span class="op">(</span>dim <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torch.mlverse.org/docs/reference/torch_randn.html" class="external-link">torch_randn</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Convert the model (for torch models is 'input_dim' required!)</span></span></span>
<span class="r-in"><span><span class="va">converter</span> <span class="op">&lt;-</span> <span class="va">Converter</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">model</span>, input_dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># You can also use the helper function `convert()` for initializing a</span></span></span>
<span class="r-in"><span><span class="co"># Converter object</span></span></span>
<span class="r-in"><span><span class="va">converter</span> <span class="op">&lt;-</span> <span class="fu"><a href="innsight_sugar.html">convert</a></span><span class="op">(</span><span class="va">model</span>, input_dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Get the converted model stored in the field 'model'</span></span></span>
<span class="r-in"><span><span class="va">converted_model</span> <span class="op">&lt;-</span> <span class="va">converter</span><span class="op">$</span><span class="va">model</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Test it with the original model</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu">converted_model</span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="fu">model</span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> torch_tensor</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [ CPUFloatType{} ][ grad_fn = &lt;MeanBackward0&gt; ]</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#----------------------- Example 2: Neuralnet ------------------------------</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://github.com/bips-hb/neuralnet" class="external-link">"neuralnet"</a></span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bips-hb/neuralnet" class="external-link">neuralnet</a></span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Train a neural network</span></span></span>
<span class="r-in"><span>  <span class="va">nn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/neuralnet/man/neuralnet.html" class="external-link">neuralnet</a></span><span class="op">(</span><span class="op">(</span><span class="va">Species</span> <span class="op">==</span> <span class="st">"setosa"</span><span class="op">)</span> <span class="op">~</span> <span class="va">Petal.Length</span> <span class="op">+</span> <span class="va">Petal.Width</span>,</span></span>
<span class="r-in"><span>    <span class="va">iris</span>,</span></span>
<span class="r-in"><span>    linear.output <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>    hidden <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span>, act.fct <span class="op">=</span> <span class="st">"tanh"</span>, rep <span class="op">=</span> <span class="fl">1</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Convert the model</span></span></span>
<span class="r-in"><span>  <span class="va">converter</span> <span class="op">&lt;-</span> <span class="fu"><a href="innsight_sugar.html">convert</a></span><span class="op">(</span><span class="va">nn</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Print all the layers</span></span></span>
<span class="r-in"><span>  <span class="va">converter</span><span class="op">$</span><span class="va">model</span><span class="op">$</span><span class="va">modules_list</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $Dense_1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> An `nn_module` containing 0 parameters.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ── Modules ─────────────────────────────────────────────────────────────────────</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> • activation_f: &lt;nn_tanh&gt; #0 parameters</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $Dense_2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> An `nn_module` containing 0 parameters.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ── Modules ─────────────────────────────────────────────────────────────────────</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> • activation_f: &lt;nn_tanh&gt; #0 parameters</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $Dense_3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> An `nn_module` containing 0 parameters.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ── Modules ─────────────────────────────────────────────────────────────────────</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> • activation_f: &lt;nn_tanh&gt; #0 parameters</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="co">#----------------------- Example 3: Keras ----------------------------------</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://tensorflow.rstudio.com/" class="external-link">"keras"</a></span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu">keras</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/keras/man/is_keras_available.html" class="external-link">is_keras_available</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tensorflow.rstudio.com/" class="external-link">keras</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Make sure keras is installed properly</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/pkg/keras/man/is_keras_available.html" class="external-link">is_keras_available</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Define a keras model</span></span></span>
<span class="r-in"><span>  <span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/keras/man/keras_model_sequential.html" class="external-link">keras_model_sequential</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_conv_2d.html" class="external-link">layer_conv_2d</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>      input_shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">32</span>, <span class="fl">32</span>, <span class="fl">3</span><span class="op">)</span>, kernel_size <span class="op">=</span> <span class="fl">8</span>, filters <span class="op">=</span> <span class="fl">8</span>,</span></span>
<span class="r-in"><span>      activation <span class="op">=</span> <span class="st">"relu"</span>, padding <span class="op">=</span> <span class="st">"same"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_conv_2d.html" class="external-link">layer_conv_2d</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>      kernel_size <span class="op">=</span> <span class="fl">8</span>, filters <span class="op">=</span> <span class="fl">4</span>,</span></span>
<span class="r-in"><span>      activation <span class="op">=</span> <span class="st">"tanh"</span>, padding <span class="op">=</span> <span class="st">"same"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_conv_2d.html" class="external-link">layer_conv_2d</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>      kernel_size <span class="op">=</span> <span class="fl">4</span>, filters <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>      activation <span class="op">=</span> <span class="st">"relu"</span>, padding <span class="op">=</span> <span class="st">"same"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_flatten.html" class="external-link">layer_flatten</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_dense.html" class="external-link">layer_dense</a></span><span class="op">(</span>units <span class="op">=</span> <span class="fl">64</span>, activation <span class="op">=</span> <span class="st">"relu"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_dense.html" class="external-link">layer_dense</a></span><span class="op">(</span>units <span class="op">=</span> <span class="fl">1</span>, activation <span class="op">=</span> <span class="st">"sigmoid"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Convert this model and save model as list</span></span></span>
<span class="r-in"><span>  <span class="va">converter</span> <span class="op">&lt;-</span> <span class="fu"><a href="innsight_sugar.html">convert</a></span><span class="op">(</span><span class="va">model</span>, save_model_as_list <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Print the converted model as a named list</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">converter</span><span class="op">$</span><span class="va">model_as_list</span>, max.level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> List of 7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ input_dim   :List of 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ input_nodes : int 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ output_dim  :List of 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ output_nodes: int 6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ layers      :List of 6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ input_names :List of 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ output_names:List of 1</span>
<span class="r-in"><span><span class="co">#----------------------- Example 4: List  ----------------------------------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define a model</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">model</span><span class="op">$</span><span class="va">input_dim</span> <span class="op">&lt;-</span> <span class="fl">5</span></span></span>
<span class="r-in"><span><span class="va">model</span><span class="op">$</span><span class="va">input_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Feat1"</span>, <span class="st">"Feat2"</span>, <span class="st">"Feat3"</span>, <span class="st">"Feat4"</span>, <span class="st">"Feat5"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">model</span><span class="op">$</span><span class="va">input_nodes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">model</span><span class="op">$</span><span class="va">output_dim</span> <span class="op">&lt;-</span> <span class="fl">2</span></span></span>
<span class="r-in"><span><span class="va">model</span><span class="op">$</span><span class="va">output_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Cat"</span>, <span class="st">"no-Cat"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">model</span><span class="op">$</span><span class="va">output_nodes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">model</span><span class="op">$</span><span class="va">layers</span><span class="op">$</span><span class="va">Layer_1</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    type <span class="op">=</span> <span class="st">"Dense"</span>,</span></span>
<span class="r-in"><span>    weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">5</span> <span class="op">*</span> <span class="fl">20</span><span class="op">)</span>, <span class="fl">20</span>, <span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    bias <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    activation_name <span class="op">=</span> <span class="st">"tanh"</span>,</span></span>
<span class="r-in"><span>    dim_in <span class="op">=</span> <span class="fl">5</span>,</span></span>
<span class="r-in"><span>    dim_out <span class="op">=</span> <span class="fl">20</span>,</span></span>
<span class="r-in"><span>    input_layers <span class="op">=</span> <span class="fl">0</span>, <span class="co"># '0' means model input layer</span></span></span>
<span class="r-in"><span>    output_layers <span class="op">=</span> <span class="fl">2</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">model</span><span class="op">$</span><span class="va">layers</span><span class="op">$</span><span class="va">Layer_2</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    type <span class="op">=</span> <span class="st">"Dense"</span>,</span></span>
<span class="r-in"><span>    weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">20</span> <span class="op">*</span> <span class="fl">2</span><span class="op">)</span>, <span class="fl">2</span>, <span class="fl">20</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    bias <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    activation_name <span class="op">=</span> <span class="st">"softmax"</span>,</span></span>
<span class="r-in"><span>    input_layers <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>    output_layers <span class="op">=</span> <span class="op">-</span><span class="fl">1</span> <span class="co"># '-1' means model output layer</span></span></span>
<span class="r-in"><span>    <span class="co">#dim_in = 20, # These values are optional, but</span></span></span>
<span class="r-in"><span>    <span class="co">#dim_out = 2  # useful for internal checks</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Convert the model</span></span></span>
<span class="r-in"><span><span class="va">converter</span> <span class="op">&lt;-</span> <span class="fu"><a href="innsight_sugar.html">convert</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Get the model as a torch::nn_module</span></span></span>
<span class="r-in"><span><span class="va">torch_model</span> <span class="op">&lt;-</span> <span class="va">converter</span><span class="op">$</span><span class="va">model</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># You can use it as a normal torch model</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">torch</span><span class="fu">::</span><span class="fu"><a href="https://torch.mlverse.org/docs/reference/torch_randn.html" class="external-link">torch_randn</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">torch_model</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[1]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> torch_tensor</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  0.1506  0.8494</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  0.4988  0.5012</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  0.0042  0.9958</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [ CPUFloatType{3,2} ]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Niklas Koenen.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer></div>






  </body></html>

